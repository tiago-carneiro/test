import{PAGES as h,DEFAULT_PAGE as d,NOT_FOUND_PAGE as p}from"./pages.config.js";const w=document.currentScript?.src||location.href,m=new URL(w,location.href),E=m.pathname.substring(0,m.pathname.lastIndexOf("/")+1);location.hash.startsWith("#/")?location.hash=location.hash.replace(/^#\/+/,"#/"):location.hash="#/"+d;const e={};let n={page:null,style:null,scroll:0};export async function router(){if(!document.getElementById("app"))return;n.page&&e[n.page]&&(e[n.page].scroll=window.scrollY);const a=(location.hash||"#/"+d).slice(1).split("/").filter(Boolean),l=a[0]||d,i=a[1],s=h[l]?l:p;await f(s,!1,i),window.scrollTo(0,e[s]?.scroll||0)}export function preloadPages(t=[]){t.forEach(o=>{h[o]&&!e[o]&&f(o,!0)})}async function f(t,o=!1,a=null){const l=document.getElementById("app");if(!o&&n.page&&e[n.page]?.js?.onDestroy&&e[n.page].js.onDestroy(),e[t]){o||(l.innerHTML=e[t].html,n.style&&(n.style.disabled=!0),document.head.contains(e[t].style)||document.head.appendChild(e[t].style),e[t].style.disabled=!1,n.style=e[t].style,e[t].js.onInit?.(a,!0),n.page=t);return}const i=`${window.location.origin}${E}pages/${h[t].component}`;try{const s=await fetch(`${i}/app.component.html`).then(c=>{if(!c.ok)throw new Error(`Erro ao carregar HTML: ${c.status}`);return c.text()}),y=await fetch(`${i}/app.component.css`).then(c=>{if(!c.ok)throw new Error(`Erro ao carregar CSS: ${c.status}`);return c.text()}),r=document.createElement("style");r.textContent=y,r.disabled=!0;const u=await import(`${i}/app.component.js`);if(e[t]={html:s,style:r,js:u,scroll:0},o)return;l.innerHTML=s,n.style&&(n.style.disabled=!0),document.head.contains(r)||document.head.appendChild(r),r.disabled=!1,n.style=r,u.onInit?.(a,!1),n.page=t}catch(s){console.error("Erro ao carregar p\xE1gina:",s),t!==p&&await f(p,!1)}}document.body.addEventListener("click",t=>{const o=t.target.closest("[data-link]");if(!o)return;t.preventDefault();const a=o.getAttribute("href").replace(/^#+/,"");location.hash="#/"+a.replace(/^\/+/,"")}),window.addEventListener("hashchange",router),preloadPages(Object.keys(h)),location.hash?location.hash=location.hash.replace(/^#\/+/,"#/"):location.hash="#/"+d,window.addEventListener("DOMContentLoaded",()=>{router()});
